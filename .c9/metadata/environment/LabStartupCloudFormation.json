{"changed":true,"filter":false,"title":"LabStartupCloudFormation.json","tooltip":"/LabStartupCloudFormation.json","value":"{\n    \"AWSTemplateFormatVersion\": \"2010-09-09\",\n    \"Description\": \"ACD_2.0\",\n    \"Parameters\": {\n        \"VpcCIDR\": {\n            \"Default\": \"10.16.0.0/16\",\n            \"Description\": \"The CIDR block for the VPC\",\n            \"Type\": \"String\",\n            \"AllowedValues\": [\n                \"10.16.0.0/16\"\n            ]\n        },\n        \"SubnetCIDR\": {\n            \"Default\": \"10.16.10.0/24\",\n            \"Description\": \"CIDR for public subnet\",\n            \"Type\": \"String\",\n            \"AllowedValues\": [\n                \"10.16.10.0/24\"\n            ]\n        },\n        \"LabUserId\": {\n            \"Default\": \"arn:aws:sts:012345678-assumed-role/vocareum-role/username\",\n            \"Description\": \"session user ARN\",\n            \"Type\": \"String\"\n        },\n        \"KeyName\": {\n            \"Description\": \"Amazon EC2 Key Pair\",\n            \"Type\": \"AWS::EC2::KeyPair::KeyName\"\n        }\n    },\n    \"Mappings\": {\n        \"RegionMap\": {\n            \"us-east-1\": {\n                \"Ubuntu\": \"ami-042e8287309f5df03\"\n            },\n            \"us-west-2\": {\n                \"Ubuntu\": \"ami-0ca5c3bd5a268e7db\"\n            }\n        }\n    },\n    \"Resources\": {\n        \"Cloud9\": {\n            \"Type\": \"AWS::Cloud9::EnvironmentEC2\",\n            \"Properties\": {\n                \"InstanceType\": \"t2.micro\",\n                \"SubnetId\": {\n                    \"Ref\": \"Subnet\"\n                },\n                \"OwnerArn\": {\n                    \"Ref\": \"LabUserId\"\n                },\n                \"Name\": \"Cloud9 Instance\",\n                \"AutomaticStopTimeMinutes\": 120\n            }\n        },\n        \"VPC\": {\n            \"Type\": \"AWS::EC2::VPC\",\n            \"Properties\": {\n                \"CidrBlock\": {\n                    \"Ref\": \"VpcCIDR\"\n                },\n                \"EnableDnsSupport\": true,\n                \"EnableDnsHostnames\": true,\n                \"Tags\": [\n                    {\n                        \"Key\": \"Name\",\n                        \"Value\": \"Cloud9 VPC\"\n                    }\n                ]\n            }\n        },\n        \"Subnet\": {\n            \"Type\": \"AWS::EC2::Subnet\",\n            \"Properties\": {\n                \"VpcId\": {\n                    \"Ref\": \"VPC\"\n                },\n                \"AvailabilityZone\": {\n                    \"Fn::Select\": [\n                        0,\n                        {\n                            \"Fn::GetAZs\": \"\"\n                        }\n                    ]\n                },\n                \"CidrBlock\": {\n                    \"Ref\": \"SubnetCIDR\"\n                },\n                \"MapPublicIpOnLaunch\": true,\n                \"Tags\": [\n                    {\n                        \"Key\": \"Name\",\n                        \"Value\": \"Cloud9 Subnet\"\n                    }\n                ]\n            }\n        },\n        \"IGW\": {\n            \"Type\": \"AWS::EC2::InternetGateway\",\n            \"DependsOn\": \"VPC\"\n        },\n        \"AttachGateway\": {\n            \"Type\": \"AWS::EC2::VPCGatewayAttachment\",\n            \"DependsOn\": [\n                \"VPC\",\n                \"IGW\"\n            ],\n            \"Properties\": {\n                \"VpcId\": {\n                    \"Ref\": \"VPC\"\n                },\n                \"InternetGatewayId\": {\n                    \"Ref\": \"IGW\"\n                }\n            }\n        },\n        \"Ec2Route\": {\n            \"Type\": \"AWS::EC2::RouteTable\",\n            \"DependsOn\": [\n                \"VPC\",\n                \"AttachGateway\"\n            ],\n            \"Properties\": {\n                \"VpcId\": {\n                    \"Ref\": \"VPC\"\n                }\n            }\n        },\n        \"RouteOut\": {\n            \"Type\": \"AWS::EC2::Route\",\n            \"DependsOn\": [\n                \"Ec2Route\",\n                \"AttachGateway\"\n            ],\n            \"Properties\": {\n                \"DestinationCidrBlock\": \"0.0.0.0/0\",\n                \"GatewayId\": {\n                    \"Ref\": \"IGW\"\n                },\n                \"RouteTableId\": {\n                    \"Ref\": \"Ec2Route\"\n                }\n            }\n        },\n        \"SubnetRouteAssociate\": {\n            \"Type\": \"AWS::EC2::SubnetRouteTableAssociation\",\n            \"DependsOn\": [\n                \"Ec2Route\",\n                \"Subnet\"\n            ],\n            \"Properties\": {\n                \"RouteTableId\": {\n                    \"Ref\": \"Ec2Route\"\n                },\n                \"SubnetId\": {\n                    \"Ref\": \"Subnet\"\n                }\n            }\n        },\n        \"Ec2AppNodeSecurityGroup\": {\n            \"Type\": \"AWS::EC2::SecurityGroup\",\n            \"Properties\": {\n                \"GroupDescription\": \"Enable HTTP access via port 8000 and 80 + SSH access\",\n                \"VpcId\": {\n                    \"Ref\": \"VPC\"\n                },\n                \"SecurityGroupIngress\": [\n                    {\n                        \"IpProtocol\": \"tcp\",\n                        \"FromPort\": 80,\n                        \"ToPort\": 80,\n                        \"CidrIp\": \"0.0.0.0/0\"\n                    },\n                    {\n                        \"IpProtocol\": \"tcp\",\n                        \"FromPort\": 22,\n                        \"ToPort\": 22,\n                        \"CidrIp\": \"0.0.0.0/0\"\n                    }\n                ]\n            }\n        },\n        \"MySQLServerSecurityGroup\": {\n            \"Type\": \"AWS::EC2::SecurityGroup\",\n            \"Properties\": {\n                \"GroupDescription\": \"Enable mysql access via port 3306 and ssh for now\",\n                \"VpcId\": {\n                    \"Ref\": \"VPC\"\n                },\n                \"SecurityGroupIngress\": [\n                    {\n                        \"IpProtocol\": \"tcp\",\n                        \"FromPort\": 3306,\n                        \"ToPort\": 3306,\n                        \"CidrIp\": \"0.0.0.0/0\"\n                    },\n                    {\n                        \"IpProtocol\": \"tcp\",\n                        \"FromPort\": 22,\n                        \"ToPort\": 22,\n                        \"CidrIp\": \"0.0.0.0/0\"\n                    }\n                ]\n            }\n        },\n        \"EC2NodeInstanceRole\": {\n            \"Type\": \"AWS::IAM::Role\",\n            \"Properties\": {\n                \"AssumeRolePolicyDocument\": {\n                    \"Version\": \"2012-10-17\",\n                    \"Statement\": {\n                        \"Action\": \"sts:AssumeRole\",\n                        \"Effect\": \"Allow\",\n                        \"Principal\": {\n                            \"Service\": \"ec2.amazonaws.com\"\n                        }\n                    }\n                },\n                \"ManagedPolicyArns\": [\n                    \"arn:aws:iam::aws:policy/AmazonSSMManagedInstanceCore\"\n                ]\n            }\n        },\n        \"Ec2AppNode\": {\n            \"Type\": \"AWS::EC2::Instance\",\n            \"DependsOn\": [\n                \"Ec2MySqlServerNode\",\n                \"AttachGateway\"\n            ],\n            \"Properties\": {\n                \"ImageId\": {\n                    \"Fn::FindInMap\": [\n                        \"RegionMap\",\n                        {\n                            \"Ref\": \"AWS::Region\"\n                        },\n                        \"Ubuntu\"\n                    ]\n                },\n                \"InstanceType\": \"t2.micro\",\n                \"KeyName\": {\n                    \"Ref\": \"KeyName\"\n                },\n                \"NetworkInterfaces\": [\n                    {\n                        \"AssociatePublicIpAddress\": \"true\",\n                        \"DeleteOnTermination\": \"true\",\n                        \"DeviceIndex\": \"0\",\n                        \"GroupSet\": [\n                            {\n                                \"Ref\": \"Ec2AppNodeSecurityGroup\"\n                            }\n                        ],\n                        \"SubnetId\": {\n                            \"Ref\": \"Subnet\"\n                        }\n                    }\n                ],\n                \"Tags\": [\n                    {\n                        \"Key\": \"Name\",\n                        \"Value\": \"AppServerNode\"\n                    }\n                ],\n                \"UserData\": {\n                    \"Fn::Base64\": {\n                        \"Fn::Sub\": \"#!/bin/bash -xe\\napt update -y\\napt install nodejs unzip wget npm -y\\nwget https://aws-tc-largeobjects.s3-us-west-2.amazonaws.com/CUR-TF-200-ACCDEV-2/lab-06-containers/code.zip -P /home/ubuntu\\ncd /home/ubuntu\\nunzip code.zip -x \\\"resources/codebase_partner/node_modules/*\\\"\\ncd resources/codebase_partner\\nnpm install\\nAPP_DB_HOST=${Ec2MySqlServerNode.PrivateIp} \\\\\\n  APP_DB_USER=nodeapp \\\\\\n  APP_DB_PASSWORD=coffee \\\\\\n  APP_DB_NAME=COFFEE \\\\\\n  APP_PORT=80 \\\\\\n  npm start\\n\"\n                    }\n                }\n            }\n        },\n        \"Ec2MySqlServerNode\": {\n            \"Type\": \"AWS::EC2::Instance\",\n            \"DependsOn\": \"AttachGateway\",\n            \"Properties\": {\n                \"ImageId\": {\n                    \"Fn::FindInMap\": [\n                        \"RegionMap\",\n                        {\n                            \"Ref\": \"AWS::Region\"\n                        },\n                        \"Ubuntu\"\n                    ]\n                },\n                \"InstanceType\": \"t2.micro\",\n                \"KeyName\": {\n                    \"Ref\": \"KeyName\"\n                },\n                \"NetworkInterfaces\": [\n                    {\n                        \"AssociatePublicIpAddress\": \"true\",\n                        \"DeleteOnTermination\": \"true\",\n                        \"DeviceIndex\": \"0\",\n                        \"GroupSet\": [\n                            {\n                                \"Ref\": \"MySQLServerSecurityGroup\"\n                            }\n                        ],\n                        \"SubnetId\": {\n                            \"Ref\": \"Subnet\"\n                        }\n                    }\n                ],\n                \"Tags\": [\n                    {\n                        \"Key\": \"Name\",\n                        \"Value\": \"MysqlServerNode\"\n                    }\n                ],\n                \"UserData\": {\n                    \"Fn::Base64\": {\n                        \"Fn::Sub\": \"#!/bin/bash -xe\\napt update -y\\napt install mysql-server -y\\nmysql -u root -e \\\"CREATE USER 'nodeapp' IDENTIFIED WITH mysql_native_password BY 'coffee'\\\";\\nmysql -u root -e \\\"GRANT all privileges on *.* to 'nodeapp'@'%';\\\"\\nmysql -u root -e \\\"CREATE DATABASE COFFEE;\\\"\\nmysql -u root -e \\\"USE COFFEE; CREATE TABLE suppliers(\\n            id INT NOT NULL AUTO_INCREMENT,\\n            name VARCHAR(255) NOT NULL,\\n            address VARCHAR(255) NOT NULL,\\n            city VARCHAR(255) NOT NULL,\\n            state VARCHAR(255) NOT NULL,\\n            email VARCHAR(255) NOT NULL,\\n            phone VARCHAR(100) NOT NULL,\\n            PRIMARY KEY ( id ));\\\"\\n\\nsed -i 's/.*bind-address.*/bind-address = 0.0.0.0/' /etc/mysql/mysql.conf.d/mysqld.cnf\\nservice mysql restart\\n\"\n                    }\n                }\n            }\n        }\n    },\n    \"Outputs\": {\n        \"AppServerPublicIp\": {\n            \"Description\": \"The public ip address for the coffee site\",\n            \"Value\": {\n                \"Fn::Sub\": \"http://${Ec2AppNode.PrivateIp}\"\n            }\n        }\n    }\n}","undoManager":{"mark":-2,"position":0,"stack":[[{"start":{"row":0,"column":0},"end":{"row":325,"column":1},"action":"insert","lines":["{","    \"AWSTemplateFormatVersion\": \"2010-09-09\",","    \"Description\": \"ACD_2.0\",","    \"Parameters\": {","        \"VpcCIDR\": {","            \"Default\": \"10.16.0.0/16\",","            \"Description\": \"The CIDR block for the VPC\",","            \"Type\": \"String\",","            \"AllowedValues\": [","                \"10.16.0.0/16\"","            ]","        },","        \"SubnetCIDR\": {","            \"Default\": \"10.16.10.0/24\",","            \"Description\": \"CIDR for public subnet\",","            \"Type\": \"String\",","            \"AllowedValues\": [","                \"10.16.10.0/24\"","            ]","        },","        \"LabUserId\": {","            \"Default\": \"arn:aws:sts:012345678-assumed-role/vocareum-role/username\",","            \"Description\": \"session user ARN\",","            \"Type\": \"String\"","        },","        \"KeyName\": {","            \"Description\": \"Amazon EC2 Key Pair\",","            \"Type\": \"AWS::EC2::KeyPair::KeyName\"","        }","    },","    \"Mappings\": {","        \"RegionMap\": {","            \"us-east-1\": {","                \"Ubuntu\": \"ami-042e8287309f5df03\"","            },","            \"us-west-2\": {","                \"Ubuntu\": \"ami-0ca5c3bd5a268e7db\"","            }","        }","    },","    \"Resources\": {","        \"Cloud9\": {","            \"Type\": \"AWS::Cloud9::EnvironmentEC2\",","            \"Properties\": {","                \"InstanceType\": \"t2.micro\",","                \"SubnetId\": {","                    \"Ref\": \"Subnet\"","                },","                \"OwnerArn\": {","                    \"Ref\": \"LabUserId\"","                },","                \"Name\": \"Cloud9 Instance\",","                \"AutomaticStopTimeMinutes\": 120","            }","        },","        \"VPC\": {","            \"Type\": \"AWS::EC2::VPC\",","            \"Properties\": {","                \"CidrBlock\": {","                    \"Ref\": \"VpcCIDR\"","                },","                \"EnableDnsSupport\": true,","                \"EnableDnsHostnames\": true,","                \"Tags\": [","                    {","                        \"Key\": \"Name\",","                        \"Value\": \"Cloud9 VPC\"","                    }","                ]","            }","        },","        \"Subnet\": {","            \"Type\": \"AWS::EC2::Subnet\",","            \"Properties\": {","                \"VpcId\": {","                    \"Ref\": \"VPC\"","                },","                \"AvailabilityZone\": {","                    \"Fn::Select\": [","                        0,","                        {","                            \"Fn::GetAZs\": \"\"","                        }","                    ]","                },","                \"CidrBlock\": {","                    \"Ref\": \"SubnetCIDR\"","                },","                \"MapPublicIpOnLaunch\": true,","                \"Tags\": [","                    {","                        \"Key\": \"Name\",","                        \"Value\": \"Cloud9 Subnet\"","                    }","                ]","            }","        },","        \"IGW\": {","            \"Type\": \"AWS::EC2::InternetGateway\",","            \"DependsOn\": \"VPC\"","        },","        \"AttachGateway\": {","            \"Type\": \"AWS::EC2::VPCGatewayAttachment\",","            \"DependsOn\": [","                \"VPC\",","                \"IGW\"","            ],","            \"Properties\": {","                \"VpcId\": {","                    \"Ref\": \"VPC\"","                },","                \"InternetGatewayId\": {","                    \"Ref\": \"IGW\"","                }","            }","        },","        \"Ec2Route\": {","            \"Type\": \"AWS::EC2::RouteTable\",","            \"DependsOn\": [","                \"VPC\",","                \"AttachGateway\"","            ],","            \"Properties\": {","                \"VpcId\": {","                    \"Ref\": \"VPC\"","                }","            }","        },","        \"RouteOut\": {","            \"Type\": \"AWS::EC2::Route\",","            \"DependsOn\": [","                \"Ec2Route\",","                \"AttachGateway\"","            ],","            \"Properties\": {","                \"DestinationCidrBlock\": \"0.0.0.0/0\",","                \"GatewayId\": {","                    \"Ref\": \"IGW\"","                },","                \"RouteTableId\": {","                    \"Ref\": \"Ec2Route\"","                }","            }","        },","        \"SubnetRouteAssociate\": {","            \"Type\": \"AWS::EC2::SubnetRouteTableAssociation\",","            \"DependsOn\": [","                \"Ec2Route\",","                \"Subnet\"","            ],","            \"Properties\": {","                \"RouteTableId\": {","                    \"Ref\": \"Ec2Route\"","                },","                \"SubnetId\": {","                    \"Ref\": \"Subnet\"","                }","            }","        },","        \"Ec2AppNodeSecurityGroup\": {","            \"Type\": \"AWS::EC2::SecurityGroup\",","            \"Properties\": {","                \"GroupDescription\": \"Enable HTTP access via port 8000 and 80 + SSH access\",","                \"VpcId\": {","                    \"Ref\": \"VPC\"","                },","                \"SecurityGroupIngress\": [","                    {","                        \"IpProtocol\": \"tcp\",","                        \"FromPort\": 80,","                        \"ToPort\": 80,","                        \"CidrIp\": \"0.0.0.0/0\"","                    },","                    {","                        \"IpProtocol\": \"tcp\",","                        \"FromPort\": 22,","                        \"ToPort\": 22,","                        \"CidrIp\": \"0.0.0.0/0\"","                    }","                ]","            }","        },","        \"MySQLServerSecurityGroup\": {","            \"Type\": \"AWS::EC2::SecurityGroup\",","            \"Properties\": {","                \"GroupDescription\": \"Enable mysql access via port 3306 and ssh for now\",","                \"VpcId\": {","                    \"Ref\": \"VPC\"","                },","                \"SecurityGroupIngress\": [","                    {","                        \"IpProtocol\": \"tcp\",","                        \"FromPort\": 3306,","                        \"ToPort\": 3306,","                        \"CidrIp\": \"0.0.0.0/0\"","                    },","                    {","                        \"IpProtocol\": \"tcp\",","                        \"FromPort\": 22,","                        \"ToPort\": 22,","                        \"CidrIp\": \"0.0.0.0/0\"","                    }","                ]","            }","        },","        \"EC2NodeInstanceRole\": {","            \"Type\": \"AWS::IAM::Role\",","            \"Properties\": {","                \"AssumeRolePolicyDocument\": {","                    \"Version\": \"2012-10-17\",","                    \"Statement\": {","                        \"Action\": \"sts:AssumeRole\",","                        \"Effect\": \"Allow\",","                        \"Principal\": {","                            \"Service\": \"ec2.amazonaws.com\"","                        }","                    }","                },","                \"ManagedPolicyArns\": [","                    \"arn:aws:iam::aws:policy/AmazonSSMManagedInstanceCore\"","                ]","            }","        },","        \"Ec2AppNode\": {","            \"Type\": \"AWS::EC2::Instance\",","            \"DependsOn\": [","                \"Ec2MySqlServerNode\",","                \"AttachGateway\"","            ],","            \"Properties\": {","                \"ImageId\": {","                    \"Fn::FindInMap\": [","                        \"RegionMap\",","                        {","                            \"Ref\": \"AWS::Region\"","                        },","                        \"Ubuntu\"","                    ]","                },","                \"InstanceType\": \"t2.micro\",","                \"KeyName\": {","                    \"Ref\": \"KeyName\"","                },","                \"NetworkInterfaces\": [","                    {","                        \"AssociatePublicIpAddress\": \"true\",","                        \"DeleteOnTermination\": \"true\",","                        \"DeviceIndex\": \"0\",","                        \"GroupSet\": [","                            {","                                \"Ref\": \"Ec2AppNodeSecurityGroup\"","                            }","                        ],","                        \"SubnetId\": {","                            \"Ref\": \"Subnet\"","                        }","                    }","                ],","                \"Tags\": [","                    {","                        \"Key\": \"Name\",","                        \"Value\": \"AppServerNode\"","                    }","                ],","                \"UserData\": {","                    \"Fn::Base64\": {","                        \"Fn::Sub\": \"#!/bin/bash -xe\\napt update -y\\napt install nodejs unzip wget npm -y\\nwget https://aws-tc-largeobjects.s3-us-west-2.amazonaws.com/CUR-TF-200-ACCDEV-2/lab-06-containers/code.zip -P /home/ubuntu\\ncd /home/ubuntu\\nunzip code.zip -x \\\"resources/codebase_partner/node_modules/*\\\"\\ncd resources/codebase_partner\\nnpm install\\nAPP_DB_HOST=${Ec2MySqlServerNode.PrivateIp} \\\\\\n  APP_DB_USER=nodeapp \\\\\\n  APP_DB_PASSWORD=coffee \\\\\\n  APP_DB_NAME=COFFEE \\\\\\n  APP_PORT=80 \\\\\\n  npm start\\n\"","                    }","                }","            }","        },","        \"Ec2MySqlServerNode\": {","            \"Type\": \"AWS::EC2::Instance\",","            \"DependsOn\": \"AttachGateway\",","            \"Properties\": {","                \"ImageId\": {","                    \"Fn::FindInMap\": [","                        \"RegionMap\",","                        {","                            \"Ref\": \"AWS::Region\"","                        },","                        \"Ubuntu\"","                    ]","                },","                \"InstanceType\": \"t2.micro\",","                \"KeyName\": {","                    \"Ref\": \"KeyName\"","                },","                \"NetworkInterfaces\": [","                    {","                        \"AssociatePublicIpAddress\": \"true\",","                        \"DeleteOnTermination\": \"true\",","                        \"DeviceIndex\": \"0\",","                        \"GroupSet\": [","                            {","                                \"Ref\": \"MySQLServerSecurityGroup\"","                            }","                        ],","                        \"SubnetId\": {","                            \"Ref\": \"Subnet\"","                        }","                    }","                ],","                \"Tags\": [","                    {","                        \"Key\": \"Name\",","                        \"Value\": \"MysqlServerNode\"","                    }","                ],","                \"UserData\": {","                    \"Fn::Base64\": {","                        \"Fn::Sub\": \"#!/bin/bash -xe\\napt update -y\\napt install mysql-server -y\\nmysql -u root -e \\\"CREATE USER 'nodeapp' IDENTIFIED WITH mysql_native_password BY 'coffee'\\\";\\nmysql -u root -e \\\"GRANT all privileges on *.* to 'nodeapp'@'%';\\\"\\nmysql -u root -e \\\"CREATE DATABASE COFFEE;\\\"\\nmysql -u root -e \\\"USE COFFEE; CREATE TABLE suppliers(\\n            id INT NOT NULL AUTO_INCREMENT,\\n            name VARCHAR(255) NOT NULL,\\n            address VARCHAR(255) NOT NULL,\\n            city VARCHAR(255) NOT NULL,\\n            state VARCHAR(255) NOT NULL,\\n            email VARCHAR(255) NOT NULL,\\n            phone VARCHAR(100) NOT NULL,\\n            PRIMARY KEY ( id ));\\\"\\n\\nsed -i 's/.*bind-address.*/bind-address = 0.0.0.0/' /etc/mysql/mysql.conf.d/mysqld.cnf\\nservice mysql restart\\n\"","                    }","                }","            }","        }","    },","    \"Outputs\": {","        \"AppServerPublicIp\": {","            \"Description\": \"The public ip address for the coffee site\",","            \"Value\": {","                \"Fn::Sub\": \"http://${Ec2AppNode.PrivateIp}\"","            }","        }","    }","}"],"id":1}]]},"ace":{"folds":[],"scrolltop":4172,"scrollleft":0,"selection":{"start":{"row":325,"column":1},"end":{"row":325,"column":1},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":297,"state":"start","mode":"ace/mode/json"}},"timestamp":1695348994540}